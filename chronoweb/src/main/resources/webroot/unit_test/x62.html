<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>X62 - postQuery - POST /epcis/queries (application/xml)</title>

</head>
<script src="../vendor/jquery/jquery.min.js"></script>
<script>
	function postQuery() {

		var queryName = $("#queryName").val();

		var tURL = 'http://localhost:8080/epcis/queries?name=' + queryName;

		var body = $('#body').val();
		$.ajax({
			type: "POST",
			url: tURL,
			contentType: "application/xml",
			data: body,
			dataType: "xml",
			crossOrigin: true
		}).done((data, textStatus, xhr) => {
			$('.result').remove();
			$('#result').empty();
			$('#result').append('<br><input class="result" type="text" value="response status" readonly />');
			$('#result').append('<input class="result" type="text" value=' + xhr.status + ' readonly />');
			$('#result').append('<br><input class="result" type="text" value="response headers" readonly />');
			$('#result').append('<textarea class="result" cols=100 rows=15 readonly>' + xhr.getAllResponseHeaders() + ' </textarea>');
			$('#result').append('<br><input class="result" type="text" value="response body" readonly />');
			if (data != null)
				$('#result').append('<textarea class="result" cols=100 rows=15 readonly>' + formatXml(new XMLSerializer().serializeToString(data)) + ' </textarea>');
		}).fail((xhr) => {
			$('.result').remove();
			$('#result').empty();
			$('#result').append('<br><input class="result" type="text" value="response status" readonly />');
			$('#result').append('<input class="result" type="text" value=' + xhr.status + ' readonly />');
			$('#result').append('<br><input class="result" type="text" value="response body" readonly />');
			$('#result').append('<textarea class="result" cols=100 rows=15 readonly>' + formatXml(xhr.responseText) + ' </textarea>');
		});
	}

	function formatXml(xml) {
		var formatted = '';
		var reg = /(>)(<)(\/*)/g;
		xml = xml.replace(reg, '$1\r\n$2$3');
		var pad = 0;
		jQuery.each(xml.split('\r\n'), function (index, node) {
			var indent = 0;
			if (node.match(/.+<\/\w[^>]*>$/)) {
				indent = 0;
			} else if (node.match(/^<\/\w/)) {
				if (pad != 0) {
					pad -= 1;
				}
			} else if (node.match(/^<\w([^>]*[^\/])?>.*$/)) {
				indent = 1;
			} else {
				indent = 0;
			}

			var padding = '';
			for (var i = 0; i < pad; i++) {
				padding += '  ';
			}

			formatted += padding + node + '\r\n';
			pad += indent;
		});

		return formatted;
	}
</script>

<body>
	<div id="url">HTTP.POST /epcis/queries (application/xml)</div>
	<input type="text" value=":queryName" readonly />
	<input id="queryName" type="text" placeholder="latestEvent" />
	<br>
	<textarea id="body" cols="100" rows="25"></textarea>
	<br>
	<input id="button" type="button" onclick="postQuery()" value="invoke" />
	<br>
	<div id="result">
	</div>
</body>
<script>
	$(document).ready(function () {
		$.ajax({
			url: "../example/createQuery-xml/latestEvent.xml",
			async: false,
			success: function (data) {
				$('#body').val(formatXml(new XMLSerializer().serializeToString(data)));
			}
		});

		$("#queryName").on('change', function postinput() {
			var queryName = $("#queryName").val();
			$('#url').html('HTTP.GET /epcis/queries?name=' + queryName + ' (application/xml)');
		});
	}); 
</script>
<footer>
	<p>Copyright Â© 2020-2024 Jaewook Byun all rights reserved.</p>
	<p>Jaewook Byun, Ph.D., Assistant Professor, Sejong University, Republic of Korea, Associate Director, Auto-ID Labs, Korea</p>
</footer>
</html>